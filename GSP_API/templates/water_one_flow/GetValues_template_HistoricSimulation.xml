<?xml version="1.0" encoding="utf-8" ?>
<wml2:Collection xmlns:wml2="http://www.opengis.net/waterml/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:om="http://www.opengis.net/om/2.0"
                 xmlns:sa="http://www.opengis.net/sampling/2.0" xmlns:swe="http://www.opengis.net/swe/2.0"
                 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sf="http://www.opengis.net/sampling/2.0"
                 xmlns:sams="http://www.opengis.net/samplingSpatial/2.0" xmlns:gco="http://www.isotc211.org/2005/gco"
                 xmlns:gmd="http://www.isotc211.org/2005/gmd"
                 xsi:schemaLocation="http://www.opengis.net/waterml/2.0 http://schemas.opengis.net/waterml/2.0/waterml2.xsd"
                 gml:id="historic_simulation_{{ reach_id }}">
  <gml:description>GEOGloWS ECMWF Streamflow Historic Simulation</gml:description>
  <wml2:metadata>
    <wml2:DocumentMetadata gml:id="generation_date">
      <wml2:generationDate>{{ generation_date }}</wml2:generationDate>
      <wml2:generationSystem>GEOGloWS ECMWF Data Service</wml2:generationSystem>
    </wml2:DocumentMetadata>
  </wml2:metadata>
  <wml2:temporalExtent>
    <gml:TimePeriod gml:id="time_range">
      <gml:beginPosition>{{ start_date }}</gml:beginPosition>
      <gml:endPosition>{{ end_date }}</gml:endPosition>
    </gml:TimePeriod>
  </wml2:temporalExtent>

  <wml2:observationMember>
    <om:OM_Observation gml:id="historic_simulation_{{ reach_id }}">
      <om:metadata>
        <wml2:ObservationMetadata>
          <gmd:contact>
            <gmd:CI_ResponsibleParty>
              <gmd:organisationName>
                <gco:CharacterString>Brigham Young University</gco:CharacterString>
              </gmd:organisationName>
              <gmd:role>
                <gmd:CI_RoleCode codeList="http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_RoleCode"
                                 codeListValue="owner"/>
              </gmd:role>
            </gmd:CI_ResponsibleParty>
          </gmd:contact>
          <gmd:dateStamp>
            <gco:DateTime>{{ start_date }}</gco:DateTime>
          </gmd:dateStamp>
          <gmd:identificationInfo/>
        </wml2:ObservationMetadata>
      </om:metadata>
      <om:phenomenonTime>
        <gml:TimePeriod gml:id="simulation_period">
          <gml:beginPosition>{{ start_date }}</gml:beginPosition>
          <gml:endPosition>{{ end_date }}</gml:endPosition>
        </gml:TimePeriod>
      </om:phenomenonTime>
      <om:resultTime>
        <gml:TimeInstant gml:id="available">
          <gml:timePosition>{{ start_date }}</gml:timePosition>
        </gml:TimeInstant>
      </om:resultTime>
      <om:procedure xlink:title="GEOGloWS ECMWF"
                    xlink:arcrole="http://www.opengis.net/def/waterml/2.0/processType/Simulation"/>
      {% if units == "meters" %}
      <om:observedProperty unitsCode="36" unitsAbbreviation="m3/s" unitsType="flow">cubic meters per second</om:observedProperty>
      {% else %}
      <om:observedProperty unitsCode="35" unitsAbbreviation="cfs" unitsType="flow">cubic feet per second</om:observedProperty>
      {% endif %}
      <om:result>
        <wml2:MeasurementTimeseries gml:id="historic_sim">
          <wml2:metadata>
            <wml2:MeasurementTimeseriesMetadata>
              <wml2:temporalExtent>
                <gml:TimePeriod gml:id="simulation_period">
                  <gml:beginPosition>{{ start_date }}</gml:beginPosition>
                  <gml:endPosition>{{ end_date }}</gml:endPosition>
                </gml:TimePeriod>
              </wml2:temporalExtent>
            </wml2:MeasurementTimeseriesMetadata>
          </wml2:metadata>
          <wml2:defaultPointMetadata>
            <wml2:DefaultTVPMeasurementMetadata>
              {% if units == "meters" %}
              <wml2:uom xlink:title="cubic meters per second"/>
              <wml2:uom code="m3/s"/>
              {% else %}
              <wml2:uom xlink:title="cubic feet per second"/>
              <wml2:uom code="cfs"/>
              {% endif %}
              <wml2:interpolationType xlink:href="http://www.opengis.net/def/waterml/2.0/interpolationType/Continuous"
                                      xlink:title="Continuous"/>
            </wml2:DefaultTVPMeasurementMetadata>
          </wml2:defaultPointMetadata>
          {% for time, value in time_value_array %}
          <wml2:point>
            <wml2:MeasurementTVP>
              <wml2:time>{{ time }}</wml2:time>
              <wml2:value>{{ val }}</wml2:value>
            </wml2:MeasurementTVP>
          </wml2:point>
          {% endfor %}
        </wml2:MeasurementTimeseries>
      </om:result>
    </om:OM_Observation>
  </wml2:observationMember>
</wml2:Collection>